<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Ã‰criture Seyes - OutilsProfs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap');

        @font-face {
            font-family: 'BelleAllure';
            src: url('./belleallure.woff2') format('woff2');
            font-weight: normal; font-style: normal;
        }

        :root {
            --bg-page: #121212; --card-bg: #1e1e1e; --text-main: #ffffff;
            --column-border: rgba(255, 255, 255, 0.1); --input-bg: #2a2a2a;
        }

        body.light-mode {
            --bg-page: #eeeeee; --card-bg: #ffffff; --text-main: #111827;
            --column-border: rgba(0, 0, 0, 0.1); --input-bg: #f3f4f6;
        }

        body { font-family: 'Inter', sans-serif; background-color: var(--bg-page); color: var(--text-main); margin: 0; transition: background 0.3s ease; }
        
        header { 
            background: var(--card-bg); border-bottom: 1px solid var(--column-border);
            position: sticky; top: 0; z-index: 100; display: flex; align-items: center;
            justify-content: space-between; padding: calc(env(safe-area-inset-top) + 10px) 15px 10px 15px; 
            width: 100%; margin-bottom: 12px;
        }

        .ui-btn-round { width: 38px; height: 38px; display: flex; align-items: center; justify-content: center; border-radius: 50%; flex-shrink: 0; transition: all 0.2s ease; cursor: pointer; border: none; }
        header h1 { font-size: 1.125rem; font-weight: 900; text-transform: uppercase; text-align: center; flex-grow: 1; }

        .main-wrapper { width: 100%; max-width: 900px; margin: 0 auto; padding: 10px 15px 40px; }
        .main-container { display: flex; flex-direction: column; gap: 20px; }
        @media (min-width: 1024px) { .main-container { flex-direction: row; align-items: flex-start; } }

        /* Zone Seyes avec marge rouge */
        .preview-area {
            flex: 1; background: white; border-radius: 1rem; overflow: hidden;
            border: 1px solid var(--column-border); min-height: 600px; position: relative;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2); padding: 40px 0;
        }

        .preview-area::after {
            content: ''; position: absolute; top: 0; bottom: 0; left: 50px;
            width: 1.5px; background-color: #ffcccc; z-index: 10;
        }

        .seyes-line {
            height: 40px; width: 100%; position: relative; background: white;
            border-bottom: 1.5px solid #555;
        }

        .seyes-line::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background-image: 
                linear-gradient(to bottom, transparent 9.5px, #add8e6 10px, transparent 10.5px, 
                                          transparent 19.5px, #add8e6 20px, transparent 20.5px,
                                          transparent 29.5px, #add8e6 30px, transparent 30.5px);
            background-size: 100% 40px;
        }

        .writing-preview {
            position: absolute; left: 55px; bottom: 1px;
            width: 100%; font-family: 'BelleAllure', cursive; 
            font-size: 31px; color: #00008B; line-height: 40px; 
            pointer-events: none; white-space: nowrap;
            font-variant-ligatures: contextual;
            font-feature-settings: "liga" 1, "calt" 1;
            letter-spacing: 0px;
        }

        .controls { flex: 0 0 320px; background: var(--card-bg); border-radius: 1.5rem; padding: 25px; border: 1px solid var(--column-border); }
        .input-field { width: 100%; background: var(--input-bg); border: 1px solid var(--column-border); color: inherit; padding: 12px; border-radius: 12px; font-weight: bold; outline: none; margin-bottom: 10px; }
        .btn-add { width: 100%; padding: 14px; border-radius: 50px; font-weight: 900; font-size: 12px; text-transform: uppercase; border: none; cursor: pointer; margin-top: 15px; }
    </style>
</head>
<body>

<header>
    <a href="generateurs.html" id="btn-retour-header" class="ui-btn-round">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M15 19l-7-7 7-7" /></svg>
    </a>
    <h1>Ã‰criture Seyes</h1>
    <button id="btn-aide" class="ui-btn-round text-lg">ðŸ’¡</button>
</header>

<div class="main-wrapper">
    <div class="main-container">
        <div class="preview-area" id="page-seyes"></div>
        <aside class="controls">
            <label class="text-[10px] font-black uppercase opacity-50 block mb-1 tracking-widest">ModÃ¨le de texte</label>
            <input type="text" id="input-text" class="input-field" oninput="updatePreview()" value="Calligraphie">
            
            <label class="text-[10px] font-black uppercase opacity-50 block mb-1 tracking-widest">Style</label>
            <select id="select-style" class="input-field" onchange="updatePreview()">
                <option value="black">Bleu Stylo</option>
                <option value="grey">Gris (Ã  repasser)</option>
            </select>
            
            <label class="text-[10px] font-black uppercase opacity-50 block mb-1 tracking-widest">Nombre de lignes</label>
            <input type="number" id="nb-lines" class="input-field" value="12" min="1" max="18" oninput="updatePreview()">
            
            <button onclick="exportPDF()" id="btn-pdf" class="btn-add">TÃ©lÃ©charger le PDF</button>
        </aside>
    </div>
</div>

<script>
    if (localStorage.getItem('theme_mode') === 'light') document.body.classList.add('light-mode');

    // N'oubliez pas de mettre votre Base64 ici pour le PDF
    const belleAllureBase64 = "VOTRE_CODE_BASE64_DU_TTF_ICI";

    function updatePreview() {
        const text = document.getElementById('input-text').value;
        const nb = document.getElementById('nb-lines').value;
        const style = document.getElementById('select-style').value;
        const container = document.getElementById('page-seyes');
        
        container.innerHTML = '';
        for (let i = 0; i < nb; i++) {
            const line = document.createElement('div');
            line.className = 'seyes-line';
            const textDiv = document.createElement('div');
            textDiv.className = 'writing-preview';
            textDiv.innerText = text;
            textDiv.style.color = style === 'grey' ? '#e2e2e2' : '#00008B';
            line.appendChild(textDiv);
            container.appendChild(line);
        }
    }

    async function exportPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('p', 'mm', 'a4');
        const text = document.getElementById('input-text').value;
        const style = document.getElementById('select-style').value;

        if (belleAllureBase64.length > 100) {
            doc.addFileToVFS('BelleAllure.ttf', belleAllureBase64);
            doc.addFont('BelleAllure.ttf', 'BelleAllure', 'normal');
            doc.setFont('BelleAllure');
        }

        const startY = 25;
        const lineSpacing = 8;
        const interSpacing = 2;

        // Ligne rouge marge
        doc.setDrawColor(255, 200, 200); doc.setLineWidth(0.4);
        doc.line(40, 10, 40, 285);

        for (let i = 0; i < 32; i++) {
            let y = startY + (i * lineSpacing);
            if (y > 285) break;

            doc.setDrawColor(100); doc.setLineWidth(0.25); doc.line(15, y, 195, y);
            doc.setDrawColor(173, 216, 230); doc.setLineWidth(0.08);
            for (let j = 1; j <= 3; j++) doc.line(15, y - (j * interSpacing), 195, y - (j * interSpacing));

            if (i < 1) { 
                doc.setTextColor(style === 'grey' ? 220 : 0, 0, style === 'grey' ? 220 : 128);
                doc.setFontSize(23); 
                doc.text(text, 42, y - 0.2, { charSpace: 0 });
            }
        }
        doc.save("fiche-ecriture.pdf");
    }

    function appliquerTheme() {
        const map = { 'red': '#ef4444', 'orange': '#f97316', 'amber': '#f59e0b', 'yellow': '#eab308', 'lime': '#84cc16', 'green': '#22c55e', 'emerald': '#10b981', 'teal': '#14b8a6', 'cyan': '#06b6d4', 'sky': '#0ea5e9', 'blue': '#3b82f6', 'indigo': '#6366f1', 'violet': '#8b5cf6', 'purple': '#a855f7', 'fuchsia': '#d946ef', 'pink': '#ec4899', 'rose': '#f43f5e' };
        const col = (JSON.parse(localStorage.getItem('theme_tuiles')) || {}).gen || 'cyan';
        const hexa = map[col];
        const contrast = ['yellow', 'lime', 'amber', 'cyan'].includes(col) ? '#000' : '#fff';
        [document.getElementById('btn-retour-header'), document.getElementById('btn-pdf')].forEach(el => {
            if(el) { el.style.backgroundColor = hexa; el.style.color = contrast; }
        });
    }

    window.onload = () => { updatePreview(); appliquerTheme(); };
</script>
</body>
</html>