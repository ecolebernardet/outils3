<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ma Classe - OutilsProfs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-app: #f8fafc;
            --bg-card: #ffffff;
            --text-main: #1e293b;
            --sub-text: #64748b;
            --student-name-girl: #ec4899;
            --student-name-boy: #3b82f6;
        }
        .dark {
            --bg-app: #0f172a;
            --bg-card: #1e293b;
            --text-main: #f1f5f9;
            --sub-text: #94a3b8;
        }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-app); color: var(--text-main); transition: all 0.3s ease; margin: 0; padding-bottom: 40px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tab-btn { opacity: 0.5; transition: all 0.2s; border-bottom: 2px solid transparent; }
        .tab-btn.active { opacity: 1; border-bottom: 2px solid currentColor; }
        .pinterest-grid { column-count: 2; column-gap: 1rem; }
        .pinterest-item { break-inside: avoid; margin-bottom: 1rem; }
        @media (max-width: 640px) { .pinterest-grid { column-count: 1; } }
        .student-item { background: var(--bg-card); border-radius: 8px; padding: 6px 10px; display: flex; align-items: center; justify-content: space-between; border: 1px solid rgba(0,0,0,0.05); }
        .text-girl-custom { color: var(--student-name-girl) !important; }
        .text-boy-custom { color: var(--student-name-boy) !important; }
        .stat-pill { padding: 4px 10px; border-radius: 99px; font-size: 10px; font-weight: 800; display: flex; align-items: center; gap: 4px; }
        .notif-export { animation: pulse-orange 1.5s infinite; }
        @keyframes pulse-orange { 0% { box-shadow: 0 0 0 0 rgba(249, 115, 22, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(249, 115, 22, 0); } 100% { box-shadow: 0 0 0 0 rgba(249, 115, 22, 0); } }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(4px); display: none; align-items: center; justify-content: center; z-index: 100; padding: 20px; }
        .modal-content { background: var(--bg-card); width: 100%; max-width: 400px; padding: 24px; border-radius: 24px; }
        .mini-pastille { display: inline-block; width: 8px; height: 8px; background: #f97316; border-radius: 50%; margin-left: 4px; }
    </style>
</head>
<body class="p-4">

    <header class="max-w-4xl mx-auto flex justify-between items-center mb-6">
        <button id="btn-retour" onclick="window.location.href='index.html'" class="p-3 rounded-xl shadow-lg active:scale-95 transition-transform">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M15 19l-7-7 7-7" /></svg>
        </button>
        <div class="flex gap-6">
            <button id="tab-btn-reg" onclick="switchTab('reg')" class="tab-btn active text-[11px] font-black uppercase tracking-widest py-2">Enregistrement</button>
            <button id="tab-btn-edit" onclick="switchTab('edit')" class="tab-btn text-[11px] font-black uppercase tracking-widest py-2">√âdition PDF</button>
        </div>
        <button id="btn-aide" onclick="ouvrirAide()" class="p-3 rounded-xl shadow-lg active:scale-95 transition-transform">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
        </button>
    </header>

    <main class="max-w-4xl mx-auto">
        <div id="tab-reg" class="tab-content active space-y-6">
            <section class="bg-[var(--bg-card)] p-6 rounded-3xl shadow-sm border border-black/5">
                <input type="text" id="nomEnseignant" oninput="sauvegarderNomEnseignant()" placeholder="Nom de l'enseignant..." class="w-full bg-transparent text-center text-lg font-black uppercase placeholder:opacity-30 outline-none mb-6">
                
                <form id="eleveForm" class="space-y-4">
                    <input type="hidden" id="edit-id">
                    <input type="text" id="nomComplet" required placeholder="Pr√©nom NOM de l'√©l√®ve..." class="w-full p-4 rounded-2xl bg-slate-100 dark:bg-slate-800 outline-none text-sm font-bold border-2 border-transparent focus:border-blue-500 transition-all">
                    
                    <div class="grid grid-cols-3 gap-2">
                        <select id="birth-day" class="p-3 rounded-xl bg-slate-100 dark:bg-slate-800 text-xs font-bold outline-none"></select>
                        <select id="birth-month" class="p-3 rounded-xl bg-slate-100 dark:bg-slate-800 text-xs font-bold outline-none"></select>
                        <select id="birth-year" class="p-3 rounded-xl bg-slate-100 dark:bg-slate-800 text-xs font-bold outline-none"></select>
                    </div>

                    <div class="flex gap-2">
                        <label class="flex-1 relative cursor-pointer group">
                            <input type="radio" name="sexe" value="m" class="peer hidden">
                            <div class="p-3 text-center rounded-xl bg-slate-100 dark:bg-slate-800 text-[10px] font-black uppercase peer-checked:bg-blue-500 peer-checked:text-white transition-all">Gar√ßon</div>
                        </label>
                        <label class="flex-1 relative cursor-pointer group">
                            <input type="radio" name="sexe" value="f" checked class="peer hidden">
                            <div class="p-3 text-center rounded-xl bg-slate-100 dark:bg-slate-800 text-[10px] font-black uppercase peer-checked:bg-pink-500 peer-checked:text-white transition-all">Fille</div>
                        </label>
                    </div>

                    <div class="flex flex-wrap gap-2 justify-center py-2">
                        <label class="cursor-pointer"><input type="radio" name="niveau" value="CP" checked class="peer hidden"><div class="px-4 py-2 rounded-lg bg-slate-100 dark:bg-slate-800 text-[10px] font-black peer-checked:bg-pink-500 peer-checked:text-white">CP</div></label>
                        <label class="cursor-pointer"><input type="radio" name="niveau" value="CE1" class="peer hidden"><div class="px-4 py-2 rounded-lg bg-slate-100 dark:bg-slate-800 text-[10px] font-black peer-checked:bg-blue-500 peer-checked:text-white">CE1</div></label>
                        <label class="cursor-pointer"><input type="radio" name="niveau" value="CE2" class="peer hidden"><div class="px-4 py-2 rounded-lg bg-slate-100 dark:bg-slate-800 text-[10px] font-black peer-checked:bg-yellow-500 peer-checked:text-white">CE2</div></label>
                        <label class="cursor-pointer"><input type="radio" name="niveau" value="CM1" class="peer hidden"><div class="px-4 py-2 rounded-lg bg-slate-100 dark:bg-slate-800 text-[10px] font-black peer-checked:bg-red-500 peer-checked:text-white">CM1</div></label>
                        <label class="cursor-pointer"><input type="radio" name="niveau" value="CM2" class="peer hidden"><div class="px-4 py-2 rounded-lg bg-slate-100 dark:bg-slate-800 text-[10px] font-black peer-checked:bg-green-500 peer-checked:text-white">CM2</div></label>
                        <label class="cursor-pointer"><input type="radio" name="niveau" value="AUTRE" class="peer hidden"><div class="px-4 py-2 rounded-lg bg-slate-100 dark:bg-slate-800 text-[10px] font-black peer-checked:bg-purple-500 peer-checked:text-white">Autre</div></label>
                    </div>

                    <button type="submit" id="btn-submit" class="w-full py-4 rounded-2xl text-[11px] font-black uppercase tracking-widest shadow-lg active:scale-95 transition-transform">Enregistrer</button>
                </form>
            </section>

            <div class="flex justify-between items-center px-2">
                <div id="stats-container" class="flex gap-2"></div>
                <div class="flex gap-1 bg-slate-200 dark:bg-slate-800 p-1 rounded-xl border border-black/5">
                    <button id="sort-prenom" onclick="changerTriApp('prenom')" class="px-3 py-1.5 rounded-lg text-[9px] font-black uppercase transition-all">Pr√©nom</button>
                    <button id="sort-nom" onclick="changerTriApp('nom')" class="px-3 py-1.5 rounded-lg text-[9px] font-black uppercase transition-all">Nom</button>
                </div>
            </div>

            <div id="listeContainer"></div>

            <div class="grid grid-cols-2 gap-3 pt-6">
                <button onclick="importerListe()" class="py-4 rounded-2xl bg-neutral-500 text-white text-[10px] font-black uppercase tracking-widest active:scale-95 transition-transform">üì• importer.txt</button>
                <button id="btn-exporter-txt" onclick="exporterListe()" class="py-4 rounded-2xl bg-neutral-500 text-white text-[10px] font-black uppercase tracking-widest active:scale-95 transition-transform">üëÜ exporter.txt üëÜ</button>
                <input type="file" id="fileInput" class="hidden" accept=".txt">
                <button onclick="toutEffacer()" class="col-span-2 py-3 text-[10px] font-bold opacity-30 hover:opacity-100 transition-opacity uppercase tracking-widest">‚ö†Ô∏è Tout effacer</button>
            </div>
        </div>

        <div id="tab-edit" class="tab-content space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <button onclick="genererPDF()" class="group flex items-center p-6 bg-[var(--bg-card)] rounded-3xl shadow-sm border border-black/5 active:scale-95 transition-transform">
                    <div class="w-12 h-12 rounded-2xl bg-blue-500/10 text-blue-500 flex items-center justify-center mr-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg></div>
                    <div class="text-left"><h4 class="text-[11px] font-black uppercase mb-1">Liste de classe</h4><p class="text-[9px] opacity-50 uppercase font-bold">PDF avec niveaux & genres</p></div>
                </button>
                <button onclick="genererEmargement()" class="group flex items-center p-6 bg-[var(--bg-card)] rounded-3xl shadow-sm border border-black/5 active:scale-95 transition-transform">
                    <div class="w-12 h-12 rounded-2xl bg-green-500/10 text-green-500 flex items-center justify-center mr-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" /></svg></div>
                    <div class="text-left"><h4 class="text-[11px] font-black uppercase mb-1">Pointage</h4><p class="text-[9px] opacity-50 uppercase font-bold">PDF avec 15 colonnes vides</p></div>
                </button>
                <button onclick="genererEtiquettes()" class="group flex items-center p-6 bg-[var(--bg-card)] rounded-3xl shadow-sm border border-black/5 active:scale-95 transition-transform">
                    <div class="w-12 h-12 rounded-2xl bg-purple-500/10 text-purple-500 flex items-center justify-center mr-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h10a2 2 0 012 2v2a2 2 0 01-2 2H7a2 2 0 01-2-2V5a2 2 0 012-2z" /></svg></div>
                    <div class="text-left"><h4 class="text-[11px] font-black uppercase mb-1">√âtiquettes</h4><p class="text-[9px] opacity-50 uppercase font-bold">8 √©tiquettes par page (A4)</p></div>
                </button>
                <button onclick="genererPetitesEtiquettes()" class="group flex items-center p-6 bg-[var(--bg-card)] rounded-3xl shadow-sm border border-black/5 active:scale-95 transition-transform">
                    <div class="w-12 h-12 rounded-2xl bg-orange-500/10 text-orange-500 flex items-center justify-center mr-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16" /></svg></div>
                    <div class="text-left"><h4 class="text-[11px] font-black uppercase mb-1">Mini √âtiquettes</h4><p class="text-[9px] opacity-50 uppercase font-bold">27 par page (Cahiers / Casiers)</p></div>
                </button>
                <button onclick="genererSuiviIndividuel()" class="group flex items-center p-6 bg-[var(--bg-card)] rounded-3xl shadow-sm border border-black/5 active:scale-95 transition-transform col-span-1 md:col-span-2">
                    <div class="w-12 h-12 rounded-2xl bg-rose-500/10 text-rose-500 flex items-center justify-center mr-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg></div>
                    <div class="text-left"><h4 class="text-[11px] font-black uppercase mb-1">Fiches de suivi individuel</h4><p class="text-[9px] opacity-50 uppercase font-bold">Format A5 (2 par page) - Observations</p></div>
                </button>
            </div>
        </div>
    </main>

    <div id="modal-aide" class="modal-overlay" onclick="fermerAide()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h2 id="aide-titre" class="text-lg font-black uppercase mb-4">üí° Ma classe</h2>
            <div class="text-[11px] leading-relaxed space-y-2 opacity-80">
                <strong>Onglet "Enregistrement" :</strong>
                <br>‚Ä¢ <strong>Saisissez</strong> votre nom dans le formulaire "Nom de l'enseignant".
                <br>‚Ä¢ <strong>Enregistrez</strong> vos √©l√®ves en ajoutant le pr√©nom, le nom, la date de naissance (optionnel). Choisissez le genre et le niveau, puis enregistrez.
                <br>‚Ä¢ <strong>Import/Export :</strong> Utilisez ces boutons pour sauvegarder votre liste sur votre appareil ou la transf√©rer vers un autre appareil au format <em>Pr√©nom;NOM;genre;niveau</em>.
                <br><br><strong>La liste g√©n√©r√©e sera utilis√©e dans les autres rubriques de l'application.</strong>
                <br>
                <br>
                <strong>Onglet "√âdition" :</strong>
                <br>‚Ä¢ <strong>G√©n√©rez</strong> votre liste de classe en PDF apr√®s avoir d√©cid√© de ranger les √©l√®ves par pr√©noms ou par noms.
                <br>‚Ä¢ <strong>G√©n√©rez</strong> une liste de pointage avec 15 cases par √©l√®ve.
                <br>‚Ä¢ <strong>G√©n√©rez</strong> des √©tiquettes au nom les √©l√®ves.
                <br>‚Ä¢ <strong>G√©n√©rez</strong> des fiches de suivi pour vos √©l√®ves.
                <br>
                <br><strong>Pastille <span class="mini-pastille"></span> :</strong> Si elle appara√Æt sur le bouton export, cela signifie que vos donn√©es locales ne sont pas synchronis√©es avec votre dernier fichier de sauvegarde.
            </div>
            <button id="btn-fermer-aide" onclick="fermerAide()" class="mt-6 w-full py-3 rounded-xl text-[10px] font-black uppercase tracking-widest active:scale-95 transition-transform">Fermer</button>
        </div>
    </div>

    <div id="custom-confirm" class="modal-overlay">
        <div class="modal-content">
            <p id="confirm-msg" class="text-center font-bold text-sm mb-6"></p>
            <div id="confirm-buttons" class="flex flex-col gap-2"></div>
        </div>
    </div>

    <script>
        const mapCouleurs = { 'red': '#ef4444', 'orange': '#f97316', 'amber': '#f59e0b', 'yellow': '#eab308', 'lime': '#84cc16', 'green': '#22c55e', 'emerald': '#10b981', 'teal': '#14b8a6', 'cyan': '#06b6d4', 'sky': '#0ea5e9', 'blue': '#3b82f6', 'indigo': '#6366f1', 'violet': '#8b5cf6', 'purple': '#a855f7', 'fuchsia': '#d946ef', 'pink': '#ec4899', 'rose': '#f43f5e', 'gray': '#6b7280' };
        const couleurParNiveau = { 'CP': '#ec4899', 'CE1': '#3b82f6', 'CE2': '#eab308', 'CM1': '#ef4444', 'CM2': '#22c55e', 'AUTRE': '#8b5cf6' };
        const ordreNiveaux = ['CP', 'CE1', 'CE2', 'CM1', 'CM2', 'AUTRE'];
        const themePrefs = JSON.parse(localStorage.getItem('theme_tuiles')) || {};
        const couleurInscr = themePrefs.inscr || 'lime';
        const hexaTheme = mapCouleurs[couleurInscr];

        let modeTriApp = localStorage.getItem('tri_eleves_app') || 'prenom';
        let eleves = JSON.parse(localStorage.getItem('maListeEleves')) || [];

        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-' + tab).classList.add('active');
            document.getElementById('tab-btn-' + tab).classList.add('active');
        }

        function sauvegarderNomEnseignant() {
            const nom = document.getElementById('nomEnseignant').value;
            localStorage.setItem('nom_enseignant', nom);
        }

        function appliquerCouleursSexe() {
            const prefs = JSON.parse(localStorage.getItem('theme_tuiles')) || {};
            const couleurFille = prefs.fille && mapCouleurs[prefs.fille] ? mapCouleurs[prefs.fille] : '#f472b6';
            const couleurGarcon = prefs.garcon && mapCouleurs[prefs.garcon] ? mapCouleurs[prefs.garcon] : '#60a5fa';
            document.documentElement.style.setProperty('--student-name-girl', couleurFille);
            document.documentElement.style.setProperty('--student-name-boy', couleurGarcon);
        }

        function initDateSelectors() {
            const daySel = document.getElementById('birth-day');
            const monthSel = document.getElementById('birth-month');
            const yearSel = document.getElementById('birth-year');
            const derniereAnnee = localStorage.getItem('derniereAnneeSaisie') || "";
            daySel.innerHTML = '<option value="">Jour</option>'; monthSel.innerHTML = '<option value="">Mois</option>'; yearSel.innerHTML = '<option value="">Ann√©e</option>';
            for(let i=1; i<=31; i++) { let val = i < 10 ? '0'+i : i; daySel.innerHTML += `<option value="${val}">${i}</option>`; }
            const mois = ["Jan.", "F√©v.", "Mar.", "Avr.", "Mai", "Juin", "Juil.", "Ao√ªt", "Sep.", "Oct.", "Nov.", "D√©c."];
            mois.forEach((m, index) => { let val = (index + 1) < 10 ? '0'+(index+1) : (index+1); monthSel.innerHTML += `<option value="${val}">${m}</option>`; });
            const currentYear = new Date().getFullYear();
            for(let i=currentYear; i>=currentYear-20; i--) { const selected = (String(i) === derniereAnnee) ? "selected" : ""; yearSel.innerHTML += `<option value="${i}" ${selected}>${i}</option>`; }
        }

        function ouvrirAide() { document.getElementById('modal-aide').style.display = 'flex'; }
        function fermerAide() { document.getElementById('modal-aide').style.display = 'none'; }

        function appliquerCouleursTheme() {
            const isDarkTxt = ['yellow', 'lime', 'amber', 'cyan'].includes(couleurInscr);
            const textClr = isDarkTxt ? '#000' : '#fff';
            const btnSubmit = document.getElementById('btn-submit');
            if (btnSubmit) { btnSubmit.style.backgroundColor = hexaTheme; btnSubmit.style.color = textClr; }
            const headerBtns = [document.getElementById('btn-retour'), document.getElementById('btn-aide')];
            headerBtns.forEach(btn => { if(btn) { btn.style.backgroundColor = hexaTheme; btn.style.color = textClr; } });
            const aideTitre = document.getElementById('aide-titre');
            if(aideTitre) aideTitre.style.color = hexaTheme;
            const btnFermerAide = document.getElementById('btn-fermer-aide');
            if(btnFermerAide) { btnFermerAide.style.backgroundColor = hexaTheme; btnFermerAide.style.color = textClr; }
            majBoutonsTri();
        }

        function majBoutonsTri() {
            const btnP = document.getElementById('sort-prenom');
            const btnN = document.getElementById('sort-nom');
            const isDarkTxt = ['yellow', 'lime', 'amber', 'cyan'].includes(couleurInscr);
            [btnP, btnN].forEach(b => { b.style.backgroundColor = 'transparent'; b.style.color = 'inherit'; b.style.opacity = '0.4'; b.style.borderColor = 'rgba(255,255,255,0.1)'; });
            const actif = modeTriApp === 'prenom' ? btnP : btnN;
            actif.style.opacity = '1'; actif.style.backgroundColor = hexaTheme; actif.style.borderColor = hexaTheme; actif.style.color = isDarkTxt ? '#000' : '#fff';
        }

        function changerTriApp(mode) {
            modeTriApp = mode;
            localStorage.setItem('tri_eleves_app', mode);
            majBoutonsTri();
            render();
        }

        function customConfirm(msg, onAction, buttons) {
            document.getElementById('confirm-msg').innerText = msg;
            const container = document.getElementById('confirm-buttons');
            container.innerHTML = "";
            const isDarkTxt = ['yellow', 'lime', 'amber', 'cyan'].includes(couleurInscr);
            buttons.forEach(btn => {
                const b = document.createElement('button');
                b.className = "w-full py-3 rounded-full text-[10px] font-black uppercase shadow-sm transition-transform active:scale-95";
                b.innerText = btn.text;
                if (btn.type === 'primary') { b.style.backgroundColor = hexaTheme; b.style.color = isDarkTxt ? '#000' : '#fff'; }
                else { b.className += " bg-neutral-500 text-white"; }
                b.onclick = () => { document.getElementById('custom-confirm').style.display = 'none'; onAction(btn.value); };
                container.appendChild(b);
            });
            document.getElementById('custom-confirm').style.display = 'flex';
        }

        function formaterIdentite(prenom, nom) { 
            const p = prenom.trim();
            const formatedPrenom = p.charAt(0).toUpperCase() + p.slice(1).toLowerCase();
            return formatedPrenom + " " + nom.trim().toUpperCase(); 
        }

        function notifierChangement() {
            localStorage.setItem('needs_export', 'true');
            const btn = document.getElementById('btn-exporter-txt');
            if (btn) {
                btn.classList.add('notif-export');
                btn.innerHTML = 'üëÜ exporter.txt üü†';
            }
        }

        function verifierDernierExport() {
            const dernierExport = localStorage.getItem('last_export_inscr');
            const needsExport = localStorage.getItem('needs_export') === 'true';
            const maintenant = new Date().getTime();
            const septJours = 7 * 24 * 60 * 60 * 1000;
            if (needsExport || !dernierExport || (maintenant - dernierExport > septJours)) {
                const btn = document.getElementById('btn-exporter-txt');
                if (btn) {
                    btn.classList.add('notif-export');
                    btn.innerHTML = 'üëÜ exporter.txt üü†';
                }
            }
        }

        function renderStats() {
            const statsDiv = document.getElementById('stats-container');
            if (!statsDiv) return;
            if (eleves.length === 0) { statsDiv.innerHTML = ""; return; }
            const nbGarcons = eleves.filter(e => e.sexe === 'm').length;
            const nbFilles = eleves.filter(e => e.sexe === 'f').length;
            statsDiv.innerHTML = `
                <div class="stat-pill border border-black/10 dark:border-white/20" style="background-color: var(--bg-card); color: var(--text-main);">Total: ${eleves.length}</div>
                <div class="stat-pill border" style="background-color: var(--student-name-boy)15; border-color: var(--student-name-boy); color: var(--student-name-boy)">‚ôÇ ${nbGarcons}</div>
                <div class="stat-pill border" style="background-color: var(--student-name-girl)15; border-color: var(--student-name-girl); color: var(--student-name-girl)">‚ôÄ ${nbFilles}</div>
            `;
        }

        function render() {
            renderStats();
            const container = document.getElementById('listeContainer');
            if (!container) return;
            container.innerHTML = eleves.length === 0 ? `<p class="text-center text-xs py-10 italic" style="color:var(--sub-text)">Aucun √©l√®ve inscrit.</p>` : "";
            const groupes = {};
            eleves.forEach(el => { if (!groupes[el.niveau]) groupes[el.niveau] = []; groupes[el.niveau].push(el); });
            const pr√©sents = Object.keys(groupes).sort((a, b) => ordreNiveaux.indexOf(a) - ordreNiveaux.indexOf(b));
            container.className = pr√©sents.length === 2 ? "grid grid-cols-2 gap-4 max-w-4xl mx-auto" : "pinterest-grid max-w-4xl mx-auto";
            pr√©sents.forEach(niv => {
                const levelColumn = document.createElement('div');
                levelColumn.className = pr√©sents.length === 2 ? "w-full" : "pinterest-item";
                const couleurNiveau = couleurParNiveau[niv] || hexaTheme;
                levelColumn.innerHTML = `<h3 style="color:${couleurNiveau}" class="text-[11px] font-black uppercase tracking-widest text-center mb-3">${niv}</h3>`;
                const list = document.createElement('div');
                list.className = "flex flex-col gap-0.5";
                groupes[niv].sort((a, b) => {
                    const partsA = a.identite.split(" "), partsB = b.identite.split(" ");
                    const pA = partsA[0], nA = partsA.slice(1).join(" ");
                    const pB = partsB[0], nB = partsB.slice(1).join(" ");
                    return modeTriApp === 'nom' ? nA.localeCompare(nB) : pA.localeCompare(pB);
                }).forEach(el => {
                    const item = document.createElement('div');
                    const genderClass = el.sexe === 'f' ? 'text-girl-custom' : 'text-boy-custom';
                    item.className = `student-item ${genderClass}`;
                    const parts = el.identite.split(" ");
                    const identiteAffiche = modeTriApp === 'nom' ? `${parts.slice(1).join(" ")} ${parts[0]}` : `${parts[0]} ${parts.slice(1).join(" ")}`;
                    item.innerHTML = `
                        <div class="flex flex-col flex-grow overflow-hidden" onclick="preparerModification('${el.id}')">
                            <span class="text-[10px] font-black truncate leading-tight">${identiteAffiche}</span>
                            ${el.dateNaissance ? `<span class="text-[8px] mt-0.5 text-gray-500">${el.dateNaissance}</span>` : ""}
                        </div>
                        <button onclick="supprimer('${el.id}')" class="ml-1 opacity-20 hover:opacity-100 p-1">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                        </button>`;
                    list.appendChild(item);
                });
                levelColumn.appendChild(list);
                container.appendChild(levelColumn);
            });
        }

        document.getElementById('eleveForm').onsubmit = (e) => {
            e.preventDefault();
            const editId = document.getElementById('edit-id').value;
            const saisie = document.getElementById('nomComplet').value.trim().split(" ");
            const day = document.getElementById('birth-day').value;
            const month = document.getElementById('birth-month').value;
            const year = document.getElementById('birth-year').value;
            let dateStockee = (day && month && year) ? `${day}-${month}-${year}` : "";
            const selectedSexe = document.querySelector('input[name="sexe"]:checked').value;
            const selectedNiveau = document.querySelector('input[name="niveau"]:checked').value;
            const data = { identite: formaterIdentite(saisie[0], saisie.slice(1).join(" ")), sexe: selectedSexe, niveau: selectedNiveau, dateNaissance: dateStockee };
            if (editId) { 
                const idx = eleves.findIndex(el => String(el.id) === String(editId)); 
                if(idx !== -1) eleves[idx] = { ...eleves[idx], ...data }; 
                document.getElementById('edit-id').value = ""; document.getElementById('btn-submit').innerText = "Enregistrer"; 
            } else { eleves.push({ id: String(Date.now()), ...data }); }
            localStorage.setItem('maListeEleves', JSON.stringify(eleves)); 
            if(year) localStorage.setItem('derniereAnneeSaisie', year);
            notifierChangement();
            render(); 
            document.getElementById('nomComplet').value = "";
            initDateSelectors();
        };

        function preparerModification(id) {
            const el = eleves.find(e => String(e.id) === String(id)); if (!el) return;
            document.getElementById('edit-id').value = el.id; document.getElementById('nomComplet').value = el.identite; 
            if (el.dateNaissance) { const parts = el.dateNaissance.split('-'); document.getElementById('birth-day').value = parts[0]; document.getElementById('birth-month').value = parts[1]; document.getElementById('birth-year').value = parts[2]; }
            document.querySelector(`input[name="sexe"][value="${el.sexe}"]`).checked = true; document.querySelector(`input[name="niveau"][value="${el.niveau}"]`).checked = true;
            document.getElementById('btn-submit').innerText = "Mettre √† jour"; window.scrollTo({ top: 0, behavior: "smooth" });
        }

        function supprimer(id) { customConfirm("Supprimer cet √©l√®ve ?", (val) => { if(val === 'yes') { eleves = eleves.filter(e => String(e.id) !== String(id)); localStorage.setItem('maListeEleves', JSON.stringify(eleves)); notifierChangement(); render(); }}, [{text: 'Supprimer', value: 'yes', type: 'primary'}, {text: 'Annuler', value: 'no'}]); }
        function toutEffacer() { customConfirm("‚ö†Ô∏è Supprimer toute la liste ?", (val) => { if(val === 'yes') { eleves = []; localStorage.setItem('maListeEleves', JSON.stringify(eleves)); notifierChangement(); render(); }}, [{text: 'Tout effacer', value: 'yes', type: 'primary'}, {text: 'Annuler', value: 'no'}]); }

        function exporterListe() {
            if (eleves.length === 0) { customConfirm("La liste est vide !", () => {}, [{text: 'D‚Äôaccord', value: 'ok', type: 'primary'}]); return; }
            let contenu = eleves.map(el => { const p = el.identite.split(" "); return `${p[0]};${p.slice(1).join(" ")};${el.sexe};${el.niveau};${el.dateNaissance||''}`; }).join("\n");
            const nomEnseignantBrut = localStorage.getItem('nom_enseignant') || "enseignant";
            const maintenant = new Date();
            const dateFormattee = `${maintenant.getFullYear()}-${String(maintenant.getMonth() + 1).padStart(2, '0')}-${String(maintenant.getDate()).padStart(2, '0')}`;
            const nomNettoye = nomEnseignantBrut.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/\s+/g, '_');
            const blob = new Blob([contenu], { type: 'text/plain' }); 
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = `outilsprofs_liste_classe_${nomNettoye}_${dateFormattee}.txt`; a.click(); URL.revokeObjectURL(url);
            localStorage.setItem('last_export_inscr', new Date().getTime());
            localStorage.setItem('needs_export', 'false');
            const btn = document.getElementById('btn-exporter-txt');
            if (btn) { btn.classList.remove('notif-export'); btn.innerHTML = 'üëÜ exporter.txt üëÜ'; }
        }

        function importerListe() { customConfirm("Importer une nouvelle liste ?", (val) => { if(val === 'yes') { document.getElementById('fileInput').click(); }}, [{text: 'Importer', value: 'yes', type: 'primary'}, {text: 'Annuler', value: 'no'}]); }

        document.getElementById('fileInput').addEventListener('change', function(e) {
            const fichier = e.target.files[0]; if (!fichier) return;
            const reader = new FileReader();
            reader.onload = function(event) {
                const lignes = event.target.result.split(/\r?\n/); const nouveaux = [];
                lignes.forEach(l => { const col = l.split(";"); if (col.length >= 4) { nouveaux.push({ id: String(Date.now() + Math.random()), identite: formaterIdentite(col[0], col[1]), sexe: col[2], niveau: col[3], dateNaissance: col[4] || "" }); } });
                if (nouveaux.length > 0) { eleves = nouveaux; localStorage.setItem('maListeEleves', JSON.stringify(eleves)); notifierChangement(); render(); }
                e.target.value = "";
            };
            reader.readAsText(fichier);
        });

        // --- FONCTIONS PDF ---
        function genererEmargement() {
            if (eleves.length === 0) { customConfirm("La liste est vide !", () => {}, [{text: 'D‚Äôaccord', value: 'ok', type: 'primary'}]); return; }
            const { jsPDF } = window.jspdf; const doc = new jsPDF('p', 'mm', 'a4');
            const nomEnseignantBrut = localStorage.getItem('nom_enseignant') || "enseignant";
            const maintenant = new Date();
            const dateFormattee = `${maintenant.getFullYear()}-${String(maintenant.getMonth() + 1).padStart(2, '0')}-${String(maintenant.getDate()).padStart(2, '0')}`;
            const groupes = {}; eleves.forEach(el => { if (!groupes[el.niveau]) groupes[el.niveau] = []; groupes[el.niveau].push(el); });
            const niveauxPresents = Object.keys(groupes).sort((a, b) => ordreNiveaux.indexOf(a) - ordreNiveaux.indexOf(b));
            doc.setFontSize(16); doc.text(`Feuille de pointage ${niveauxPresents.join(" / ")} - ${nomEnseignantBrut}`, 105, 15, { align: "center" });
            let finalBody = []; let compteurGlobal = 1;
            niveauxPresents.forEach(niv => {
                finalBody.push([{ content: niv, colSpan: 17, styles: { fillColor: [160, 160, 160], textColor: [255, 255, 255], fontStyle: 'bold', halign: 'left' } }]);
                groupes[niv].sort((a, b) => {
                    const partsA = a.identite.split(" "), partsB = b.identite.split(" ");
                    return modeTriApp === 'nom' ? partsA.slice(1).join(" ").localeCompare(partsB.slice(1).join(" ")) : partsA[0].localeCompare(partsB[0]);
                }).forEach((el) => {
                    const pts = el.identite.split(" ");
                    const idAffiche = modeTriApp === 'nom' ? `${pts.slice(1).join(" ")} ${pts[0]}` : `${pts[0]} ${pts.slice(1).join(" ")}`;
                    finalBody.push([compteurGlobal++, idAffiche, ...Array(15).fill('')]);
                });
            });
            doc.autoTable({ head: [[...Array(17).fill('')]], body: finalBody, startY: 25, theme: 'grid', alternateRowStyles: { fillColor: [230, 230, 230] }, headStyles: { fillColor: [255, 255, 255], lineWidth: 0.1, lineColor: [0, 0, 0], minCellHeight: 16 }, styles: { fontSize: 7, cellPadding: 1.5, lineColor: [0, 0, 0], textColor: [0, 0, 0] }, columnStyles: { 0: { cellWidth: 7, halign: 'center' }, 1: { cellWidth: 'auto' }, 2: { cellWidth: 8 }, 3: { cellWidth: 8 }, 4: { cellWidth: 8 }, 5: { cellWidth: 8 }, 6: { cellWidth: 8 }, 7: { cellWidth: 8 }, 8: { cellWidth: 8 }, 9: { cellWidth: 8 }, 10: { cellWidth: 8 }, 11: { cellWidth: 8 }, 12: { cellWidth: 8 }, 13: { cellWidth: 8 }, 14: { cellWidth: 8 }, 15: { cellWidth: 8 }, 16: { cellWidth: 8 } }, didParseCell: function (data) { if (data.section === 'head' && (data.column.index === 0 || data.column.index === 1)) { data.cell.styles.lineWidth = 0; } if (data.section === 'body' && data.cell.raw && data.cell.raw.colSpan === 17) { data.cell.styles.fillColor = [160, 160, 160]; } } });
            const nomNettoye = nomEnseignantBrut.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/\s+/g, '_');
            doc.save(`pointage_${nomNettoye}_${dateFormattee}.pdf`);
        }

        function genererPDF() {
            if (eleves.length === 0) { customConfirm("La liste est vide !", () => {}, [{text: 'D‚Äôaccord', value: 'ok', type: 'primary'}]); return; }
            const { jsPDF } = window.jspdf; const doc = new jsPDF();
            const nomEnseignantBrut = localStorage.getItem('nom_enseignant') || "enseignant";
            const maintenant = new Date(); const dateFormattee = `${maintenant.getFullYear()}-${String(maintenant.getMonth() + 1).padStart(2, '0')}-${String(maintenant.getDate()).padStart(2, '0')}`;
            const groupes = {}; eleves.forEach(el => { if (!groupes[el.niveau]) groupes[el.niveau] = []; groupes[el.niveau].push(el); });
            const niveauxPresents = Object.keys(groupes).sort((a, b) => ordreNiveaux.indexOf(a) - ordreNiveaux.indexOf(b));
            doc.setFontSize(18); doc.text(`Liste de la classe de ${nomEnseignantBrut}`, 105, 15, { align: "center" });
            doc.setFontSize(12); doc.text(niveauxPresents.join(" / "), 105, 22, { align: "center" });
            let finalBody = []; let compteurGlobal = 1;
            niveauxPresents.forEach(niv => {
                finalBody.push([{ content: niv, colSpan: 5, styles: { fillColor: [160, 160, 160], textColor: [255, 255, 255], fontStyle: 'bold', halign: 'left' } }]);
                groupes[niv].sort((a, b) => {
                    const partsA = a.identite.split(" "), partsB = b.identite.split(" ");
                    return modeTriApp === 'nom' ? partsA.slice(1).join(" ").localeCompare(partsB.slice(1).join(" ")) : partsA[0].localeCompare(partsB[0]);
                }).forEach((el) => {
                    const pts = el.identite.split(" ");
                    const idPDF = modeTriApp === 'nom' ? `${pts.slice(1).join(" ")} ${pts[0]}` : `${pts[0]} ${pts.slice(1).join(" ")}`;
                    finalBody.push([compteurGlobal++, idPDF, el.dateNaissance || '-', el.sexe.toUpperCase(), el.niveau]);
                });
            });
            doc.autoTable({ head: [], body: finalBody, startY: 30, theme: 'grid', alternateRowStyles: { fillColor: [230, 230, 230] }, styles: { fontSize: 9, lineColor: [0, 0, 0] }, didParseCell: function (data) { if (data.section === 'body' && data.cell.raw && data.cell.raw.colSpan === 5) { data.cell.styles.fillColor = [160, 160, 160]; } } });
            const nomNettoye = nomEnseignantBrut.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/\s+/g, '_');
            doc.save(`outilsprofs_liste_classe_${nomNettoye}_${dateFormattee}.pdf`);
        }

        function genererEtiquettes() {
            if (!eleves || eleves.length === 0) { customConfirm("La liste est vide !", () => {}, [{text: 'D‚Äôaccord', value: 'ok', type: 'primary'}]); return; }
            const { jsPDF } = window.jspdf; const doc = new jsPDF();
            const nomEnseignantBrut = localStorage.getItem('nom_enseignant') || "enseignant";
            const maintenant = new Date(); const dateFormattee = `${maintenant.getFullYear()}-${String(maintenant.getMonth() + 1).padStart(2, '0')}-${String(maintenant.getDate()).padStart(2, '0')}`;
            const nomNettoye = nomEnseignantBrut.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/\s+/g, '_');
            const margin = 10, gap = 10, cols = 2, rows = 4;
            const cardWidth = (210 - (2 * margin) - gap) / cols, cardHeight = (297 - (2 * margin) - (3 * gap)) / rows;
            let col = 0, row = 0;
            const elevesTries = [...eleves].sort((a, b) => {
                const partsA = a.identite.split(" "), partsB = b.identite.split(" ");
                return modeTriApp === 'nom' ? partsA.slice(1).join(" ").localeCompare(partsB.slice(1).join(" ")) : partsA[0].localeCompare(partsB[0]);
            });
            elevesTries.forEach((el, index) => {
                if (index > 0 && index % (cols * rows) === 0) { doc.addPage(); col = 0; row = 0; }
                const x = margin + (col * (cardWidth + gap)), y = margin + (row * (cardHeight + gap));
                doc.setDrawColor(200); doc.roundedRect(x, y, cardWidth, cardHeight, 3, 3, 'S');
                const parts = el.identite.split(" "), prenom = parts[0], nom = parts.slice(1).join(" ");
                doc.setFontSize(24); doc.setTextColor(40); doc.text(prenom, x + cardWidth / 2, y + cardHeight / 2, { align: 'center' });
                doc.setFontSize(10); doc.setTextColor(100); doc.text(nom, x + cardWidth / 2, y + cardHeight / 2 + 10, { align: 'center' });
                doc.setFontSize(8); doc.text(el.niveau, x + cardWidth - 5, y + cardHeight - 5, { align: 'right' });
                col++; if (col === cols) { col = 0; row++; }
            });
            doc.save(`outilsprofs_etiquettes_${nomNettoye}_${dateFormattee}.pdf`);
        }

        function genererPetitesEtiquettes() {
            if (!eleves || eleves.length === 0) { customConfirm("La liste est vide !", () => {}, [{text: 'D‚Äôaccord', value: 'ok', type: 'primary'}]); return; }
            const { jsPDF } = window.jspdf; const doc = new jsPDF('p', 'mm', 'a4');
            const nomEnseignantBrut = localStorage.getItem('nom_enseignant') || "enseignant";
            const maintenant = new Date(); const dateFormattee = `${maintenant.getFullYear()}-${String(maintenant.getMonth() + 1).padStart(2, '0')}-${String(maintenant.getDate()).padStart(2, '0')}`;
            const nomNettoye = nomEnseignantBrut.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/\s+/g, '_');
            const marginX = 10, marginY = 12, cols = 3, rows = 9, gap = 4;
            const cardWidth = (210 - (2 * marginX) - ((cols - 1) * gap)) / cols, cardHeight = (297 - (2 * marginY) - ((rows - 1) * gap)) / rows;
            let col = 0, row = 0;
            const elevesTries = [...eleves].sort((a, b) => {
                const partsA = a.identite.split(" "), partsB = b.identite.split(" ");
                return modeTriApp === 'nom' ? partsA.slice(1).join(" ").localeCompare(partsB.slice(1).join(" ")) : partsA[0].localeCompare(partsB[0]);
            });
            elevesTries.forEach((el, index) => {
                if (index > 0 && index % (cols * rows) === 0) { doc.addPage(); col = 0; row = 0; }
                const x = marginX + (col * (cardWidth + gap)), y = marginY + (row * (cardHeight + gap));
                doc.setDrawColor(220); doc.setLineWidth(0.1); doc.rect(x, y, cardWidth, cardHeight, 'S');
                const parts = el.identite.split(" "), prenom = parts[0], nom = parts.slice(1).join(" ");
                doc.setFont("helvetica", "bold"); doc.setFontSize(11); doc.setTextColor(0); doc.text(prenom, x + cardWidth / 2, y + (cardHeight / 2) - 1, { align: 'center' });
                doc.setFont("helvetica", "normal"); doc.setFontSize(8); doc.setTextColor(100); doc.text(nom, x + cardWidth / 2, y + (cardHeight / 2) + 4, { align: 'center' });
                doc.setFontSize(6); doc.setTextColor(180); doc.text(el.niveau, x + cardWidth - 2, y + cardHeight - 2, { align: 'right' });
                col++; if (col === cols) { col = 0; row++; }
            });
            doc.save(`outilsprofs_petitesetiquettes_${nomNettoye}_${dateFormattee}.pdf`);
        }

        function genererSuiviIndividuel() {
            if (eleves.length === 0) { customConfirm("La liste est vide !", () => {}, [{text: 'D‚Äôaccord', value: 'ok', type: 'primary'}]); return; }
            const { jsPDF } = window.jspdf; const doc = new jsPDF('l', 'mm', 'a4');
            const nomEnseignantBrut = localStorage.getItem('nom_enseignant') || "enseignant";
            const maintenant = new Date(); const dateFormattee = `${maintenant.getFullYear()}-${String(maintenant.getMonth() + 1).padStart(2, '0')}-${String(maintenant.getDate()).padStart(2, '0')}`;
            const nomNettoye = nomEnseignantBrut.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/\s+/g, '_');
            const elevesTries = [...eleves].sort((a, b) => {
                const partsA = a.identite.split(" "), partsB = b.identite.split(" ");
                return modeTriApp === 'nom' ? partsA.slice(1).join(" ").localeCompare(partsB.slice(1).join(" ")) : partsA[0].localeCompare(partsB[0]);
            });
            elevesTries.forEach((el, index) => {
                if (index > 0 && index % 2 === 0) doc.addPage('l');
                const position = index % 2, offsetX = position * 148.5;
                doc.setFillColor(248, 248, 248); doc.rect(offsetX + 10, 10, 128.5, 20, 'F');
                doc.setFontSize(8); doc.setTextColor(120); doc.text(`Suivi P√©dagogique - Classe de ${nomEnseignantBrut}`, offsetX + 15, 18);
                doc.text(`Ann√©e Scolaire 2025-2026`, offsetX + 15, 24);
                doc.setFontSize(16); doc.setTextColor(0); doc.setFont("helvetica", "bold"); doc.text(el.identite, offsetX + 74.25, 45, { align: "center" });
                doc.setFontSize(10); doc.setFont("helvetica", "normal");
                const infoNiveau = `Niveau : ${el.niveau}`, infoNaissance = el.dateNaissance ? ` - N√©(e) le : ${el.dateNaissance}` : "";
                doc.text(infoNiveau + infoNaissance, offsetX + 74.25, 52, { align: "center" });
                doc.setDrawColor(200); doc.line(offsetX + 30, 58, offsetX + 118, 58);
                doc.setFontSize(9); doc.setTextColor(150); doc.setFont("helvetica", "italic"); doc.text("OBSERVATIONS / NOTES :", offsetX + 15, 68);
                doc.setDrawColor(230); doc.roundedRect(offsetX + 10, 72, 128.5, 120, 2, 2, 'S');
                doc.setDrawColor(240); for (let i = 0; i < 10; i++) { doc.line(offsetX + 15, 85 + (i * 11), offsetX + 133.5, 85 + (i * 11)); }
                if (position === 0) { doc.setDrawColor(220); doc.setLineDashPattern([2, 2], 0); doc.line(148.5, 5, 148.5, 205); doc.setLineDashPattern([], 0); }
            });
            doc.save(`outilsprofs_fiches_suivi_classe_${nomNettoye}_${dateFormattee}.pdf`);
        }

        window.onload = () => { 
            const nomStocke = localStorage.getItem('nom_enseignant') || "";
            document.getElementById('nomEnseignant').value = nomStocke;
            initDateSelectors(); appliquerCouleursSexe(); appliquerCouleursTheme(); render(); 
            verifierDernierExport();
        };
    </script>
</body>
</html>