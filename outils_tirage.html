<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tirage au Sort - OutilsProfs</title>
    
    <!-- Initialisation du mode clair avant le chargement pour √©viter le flash -->
    <script>
        (function() {
            const mode = localStorage.getItem('theme_mode');
            if (mode === 'light') {
                document.documentElement.classList.add('light-mode-init');
            }
        })();
    </script>

    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap');
        
        /* ========== VARIABLES CSS ========== */
        :root {
            --bg-page: #121212;
            --text-page: #ffffff;
            --header-bg: #1e1e1e;
            --header-border: rgba(255, 255, 255, 0.1);
            --border-color: rgba(255, 255, 255, 0.1);
            --card-bg: #0a0a0a;
            --card-text: #ffffff;
            --result-bg: #111111;
            --result-border: #262626;
            --pill-bg: #1a1a1a;
            --student-name-boy: #93c5fd;
            --student-name-girl: #f9a8d4;
        }

        body.light-mode,
        html.light-mode-init body {
            --bg-page: #eeeeee;
            --text-page: #000000;
            --header-bg: #ffffff;
            --header-border: #dddddd;
            --border-color: #cccccc;
            --card-bg: #ffffff;
            --card-text: #000000;
            --result-bg: #f5f5f5;
            --result-border: #dddddd;
            --pill-bg: #ffffff;
        }

        /* ========== STYLES DE BASE ========== */
        body { 
            font-family: 'Inter', sans-serif;
            background: var(--bg-page);
            color: var(--text-page);
            padding: 0;
            margin: 0;
            transition: background 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-left: 15px;
            padding-right: 15px;
            padding-bottom: 20px;
        }

        /* ========== HEADER ========== */
        header { 
            background: var(--header-bg);
            border-bottom: 1px solid var(--header-border);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: calc(env(safe-area-inset-top) + 10px) 15px 10px 15px;
            width: calc(100% + 30px);
            margin-left: -15px;
            margin-bottom: 10px;
        }

        header h1 {
            font-weight: 900;
            font-size: 1.125rem;
            letter-spacing: normal;
            text-transform: uppercase;
            text-align: center;
            flex-grow: 1;
        }

        .header-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            text-decoration: none;
        }

        .header-btn:active {
            transform: scale(0.9);
        }

        /* ========== BOUTON RETOUR LISTE ========== */
        .btn-retour-liste {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-weight: 900;
            font-size: 10px;
            text-transform: uppercase;
            transition: transform 0.2s;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            text-decoration: none;
        }

        .btn-retour-liste:active {
            transform: scale(0.95);
        }

        /* ========== GRILLE D'√âL√àVES ========== */
        .student-grid { 
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 6px;
            margin-bottom: 20px;
            width: 100%;
            padding: 0 10px;
        }

        @media (min-width: 768px) {
            .student-grid {
                grid-template-columns: repeat(10, 1fr);
                gap: 15px;
            }
        }

        .student-item { 
            padding: 6px 2px;
            border-radius: 999px;
            font-size: 0.55rem;
            font-weight: 800;
            text-align: center;
            cursor: pointer;
            background-color: var(--pill-bg);
            border: 1px solid var(--header-border);
            transition: all 0.2s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        @media (min-width: 768px) {
            .student-item {
                font-size: 0.6rem;
                padding: 10px 2px;
            }
        }

        @media (min-width: 1024px) {
            .student-item {
                font-size: 0.9rem;
                padding: 10px 2px;
            }
        }

        .student-item.bg-f {
            color: var(--student-name-girl) !important;
        }

        .student-item.bg-m {
            color: var(--student-name-boy) !important;
        }

        .student-item.drawn { 
            background-color: #0a0a0a !important;
            color: #444444 !important;
            text-decoration: line-through;
            border-color: #1a1a1a !important;
            opacity: 0.5;
            transform: scale(0.96);
        }

        body.light-mode .student-item.drawn,
        html.light-mode-init .student-item.drawn { 
            background: #e0e0e0 !important;
            color: #aaaaaa !important;
            border-color: #cccccc !important;
        }

        /* ========== TITRE DE NIVEAU ========== */
        .level-title { 
            text-align: center;
            font-size: 10px;
            font-weight: 900;
            margin: 15px 0 5px 0;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-page);
        }

        /* ========== CARTES ========== */
        .light-card { 
            background: var(--card-bg);
            color: var(--card-text);
            border-radius: 1.5rem;
            width: 95%;
            max-width: 400px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 25px rgba(0, 0, 0, 0.6);
        }

        .result-box { 
            background: var(--result-bg);
            border: 1px solid var(--result-border);
            border-radius: 0.75rem;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
            font-size: 1.4rem;
            font-weight: 800;
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* ========== BOUTONS ========== */
        .main-btn {
            width: 100%;
            padding: 14px;
            font-size: 10px;
            font-weight: 900;
            border-radius: 50px;
            text-transform: uppercase;
            border: none;
            cursor: pointer;
            transition: transform 0.1s, opacity 0.2s;
        }

        .main-btn:active {
            transform: scale(0.95);
        }

        .main-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(0.5);
        }

        .btn-nav { 
            width: 100%;
            max-width: 400px;
            font-weight: 800;
            padding: 14px;
            border-radius: 50px;
            font-size: 10px;
            cursor: pointer;
            border: none;
            transition: transform 0.2s;
        }

        .btn-nav:active {
            transform: scale(0.98);
        }

        /* ========== STATISTIQUES ========== */
        .stats { 
            margin-top: 8px;
            font-size: 0.6rem;
            color: #888888;
            text-transform: uppercase;
            font-weight: 800;
        }

        /* ========== MODAUX ========== */
        .modal-overlay { 
            display: none;
            position: fixed;
            inset: 0;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(4px);
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content { 
            background: white;
            padding: 24px;
            border-radius: 24px;
            width: 100%;
            max-width: 360px;
            color: #111;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .alert-title { 
            font-size: 18px;
            font-weight: 900;
            text-transform: uppercase;
            color: #111;
            margin-bottom: 8px;
            text-align: center;
        }

        .alert-text { 
            font-size: 14px;
            color: #444;
            text-align: center;
            line-height: 1.5;
            font-weight: 500;
        }

        .modal-btns {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-btn { 
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 16px;
            font-weight: 900;
            font-size: 11px;
            text-transform: uppercase;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .modal-btn:active {
            transform: scale(0.95);
        }

        .modal-btn-cancel {
            background: #eeeeee;
            color: #444;
        }
    </style>
</head>
<body>

    <!-- ========== HEADER ========== -->
    <header>
        <a href="outils.html" id="btn-retour" class="header-btn" aria-label="Retour aux outils">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M15 19l-7-7 7-7" />
            </svg>
        </a>
        <h1 id="page-title">Tirage au sort</h1>
        <button id="btn-aide" class="header-btn text-lg" aria-label="Aide">üí°</button>
    </header>

    <!-- ========== BOUTON RETOUR LISTE ========== -->
    <div class="w-full flex justify-start mb-4 mt-2 px-4">
        <a href="outils.html" id="btn-retour-liste" class="btn-retour-liste">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M15 19l-7-7 7-7" />
            </svg>
            Retour aux outils
        </a>
    </div>
    
    <!-- ========== LISTE DES √âL√àVES ========== -->
    <div class="w-full" id="listeContainer" style="max-width: 95%; margin: 0 auto;"></div>

    <!-- ========== CARTE DE R√âSULTAT ========== -->
    <div class="light-card mx-auto">
        <div class="result-box" id="result-display">PR√äT</div>
        <button id="draw-btn" class="main-btn">Tirer un pr√©nom</button>
        <div class="stats" id="counter">--</div>
    </div>

    <!-- ========== BOUTON R√âINITIALISATION ========== -->
    <div class="max-w-md mx-auto flex justify-center mt-4 mb-10 w-full px-4">
        <button id="reset-btn" class="btn-nav bg-red-500 text-white shadow-lg">‚ö†Ô∏è R√†Z du tirage</button>
    </div>

    <!-- ========== MODAL ========== -->
    <div id="alertModal" class="modal-overlay">
        <div class="modal-content">
            <div id="modal-body-content">
                <h3 class="alert-title">Confirmation</h3>
                <p class="alert-text">Voulez-vous continuer ?</p>
            </div>
            <div class="modal-btns">
                <button id="btn-secondary" class="modal-btn modal-btn-cancel">Annuler</button>
                <button id="alertConfirmBtn" class="modal-btn text-white">Confirmer</button>
            </div>
        </div>
    </div>

    <script>
        // ========== CONFIGURATION & CONSTANTES ========== 
        const CONFIG = {
            DRAW_ITERATIONS: 15,
            DRAW_INTERVAL: 70,
            ANIMATION_SCALE_UP: 1.1,
            ANIMATION_SCALE_DOWN: 0.95,
            ANIMATION_DURATION: 200
        };

        const COLOR_MAP = {
            'red': '#ef4444', 'orange': '#f97316', 'amber': '#f59e0b', 'yellow': '#eab308',
            'lime': '#84cc16', 'green': '#22c55e', 'emerald': '#10b981', 'teal': '#14b8a6',
            'cyan': '#06b6d4', 'sky': '#0ea5e9', 'blue': '#3b82f6', 'indigo': '#6366f1',
            'violet': '#8b5cf6', 'purple': '#a855f7', 'fuchsia': '#d946ef', 'pink': '#ec4899',
            'rose': '#f43f5e', 'gray': '#666666'
        };

        const LEVEL_COLORS = {
            'CP': '#ec4899',
            'CE1': '#3b82f6',
            'CE2': '#eab308',
            'CM1': '#ef4444',
            'CM2': '#22c55e',
            'AUTRE': '#a855f7'
        };

        const LEVEL_ORDER = ['CP', 'CE1', 'CE2', 'CM1', 'CM2', 'AUTRE'];

        const STORAGE_KEYS = {
            students: 'maListeEleves',
            remaining: 'remainingStudents',
            levelPalette: 'palette_niveaux',
            theme: 'theme_tuiles',
            themeMode: 'theme_mode'
        };

        const LIGHT_CONTRAST_COLORS = ['yellow', 'lime', 'amber', 'cyan'];

        // ========== √âTAT DE L'APPLICATION ========== 
        const state = {
            rawData: JSON.parse(localStorage.getItem(STORAGE_KEYS.students)) || [],
            remaining: JSON.parse(localStorage.getItem(STORAGE_KEYS.remaining)) || [],
            isDrawing: false
        };

        // Initialiser remaining si vide
        if (state.remaining.length === 0 && state.rawData.length > 0) {
            state.remaining = state.rawData.map(el => el.id);
        }

        // ========== TH√àME ========== 
        const themePrefs = JSON.parse(localStorage.getItem(STORAGE_KEYS.theme)) || {};
        const THEME_COLOR_NAME = themePrefs.outils || 'blue';
        const THEME_HEX = COLOR_MAP[THEME_COLOR_NAME] || '#3b82f6';
        const THEME_TEXT_COLOR = LIGHT_CONTRAST_COLORS.includes(THEME_COLOR_NAME) ? '#000000' : '#ffffff';

        // Injection imm√©diate des variables CSS
        document.documentElement.style.setProperty('--theme-color', THEME_HEX);
        document.documentElement.style.setProperty('--contrast-color', THEME_TEXT_COLOR);

        // ========== √âL√âMENTS DOM ========== 
        const elements = {
            pageTitle: document.getElementById('page-title'),
            btnRetour: document.getElementById('btn-retour'),
            btnRetourListe: document.getElementById('btn-retour-liste'),
            btnAide: document.getElementById('btn-aide'),
            listeContainer: document.getElementById('listeContainer'),
            resultDisplay: document.getElementById('result-display'),
            drawBtn: document.getElementById('draw-btn'),
            counter: document.getElementById('counter'),
            resetBtn: document.getElementById('reset-btn'),
            alertModal: document.getElementById('alertModal'),
            modalBodyContent: document.getElementById('modal-body-content'),
            btnSecondary: document.getElementById('btn-secondary'),
            alertConfirmBtn: document.getElementById('alertConfirmBtn')
        };

        // ========== GESTION DU STOCKAGE ========== 
        function saveState() {
            localStorage.setItem(STORAGE_KEYS.remaining, JSON.stringify(state.remaining));
        }

        // ========== FORMATAGE DES NOMS ========== 
        function formatName(fullName) {
            const parts = fullName.trim().split(" ");
            const prenom = parts[0];
            const nom = parts.slice(1).join(" ");
            
            const hasDuplicate = state.rawData.some(s => 
                s.identite.trim().split(" ")[0].toLowerCase() === prenom.toLowerCase() && 
                s.identite.trim() !== fullName.trim()
            );
            
            return hasDuplicate && nom ? `${prenom} ${nom}` : prenom;
        }

        function getStudentById(id) {
            return state.rawData.find(s => s.id === id);
        }

        function getGenderClass(student) {
            return student.sexe.toLowerCase().startsWith('f') ? 'bg-f' : 'bg-m';
        }

        function isStudentDrawn(id) {
            return !state.remaining.includes(id);
        }

        // ========== GESTION DES NIVEAUX ========== 
        function groupStudentsByLevel() {
            const groups = {};
            state.rawData.forEach(el => {
                const niv = el.niveau.trim().toUpperCase();
                if (!groups[niv]) groups[niv] = [];
                groups[niv].push(el);
            });
            return groups;
        }

        function getSortedLevels(groups) {
            return Object.keys(groups).sort((a, b) => {
                const indexA = LEVEL_ORDER.indexOf(a);
                const indexB = LEVEL_ORDER.indexOf(b);
                return (indexA === -1 ? 99 : indexA) - (indexB === -1 ? 99 : indexB);
            });
        }

        function getLevelColor(level) {
            const customPalette = JSON.parse(localStorage.getItem(STORAGE_KEYS.levelPalette)) || {};
            return customPalette[level] || customPalette[level.toLowerCase()] || LEVEL_COLORS[level] || '#888888';
        }

        // ========== RENDU DE LA LISTE ========== 
        function renderList() {
            const groups = groupStudentsByLevel();
            const sortedLevels = getSortedLevels(groups);
            let html = '';

            sortedLevels.forEach(niv => {
                const levelColor = getLevelColor(niv);
                html += `<div><div class="level-title" style="color: ${levelColor} !important;">${niv}</div>`;
                html += `<div class="student-grid">`;

                groups[niv]
                    .sort((a, b) => a.identite.localeCompare(b.identite))
                    .forEach(el => {
                        const genderClass = getGenderClass(el);
                        const drawnClass = isStudentDrawn(el.id) ? 'drawn' : '';
                        const displayName = formatName(el.identite);
                        html += `<div class="student-item ${genderClass} ${drawnClass}" data-student-id="${el.id}">${displayName}</div>`;
                    });

                html += `</div></div>`;
            });

            elements.listeContainer.innerHTML = html;

            // Ajouter les √©v√©nements de clic
            document.querySelectorAll('.student-item').forEach(item => {
                item.addEventListener('click', () => toggleStudent(parseInt(item.dataset.studentId)));
            });

            updateStats();
        }

        function updateStats() {
            const total = state.rawData.length;
            const restants = state.remaining.length;
            const pluralSuffix = restants > 1 ? 's' : '';
            
            elements.counter.innerText = `${restants} restant${pluralSuffix} / ${total}`;

            if (restants === 0) {
                elements.drawBtn.disabled = true;
                elements.drawBtn.innerText = "Session termin√©e";
            } else {
                elements.drawBtn.disabled = false;
                elements.drawBtn.innerText = "Tirer un pr√©nom";
            }
        }

        // ========== INTERACTION AVEC LES √âL√àVES ========== 
        function toggleStudent(id) {
            if (state.remaining.includes(id)) {
                state.remaining = state.remaining.filter(item => item !== id);
            } else {
                state.remaining.push(id);
            }
            saveState();
            renderList();
        }

        // ========== ANIMATION DU TIRAGE ========== 
        function drawName() {
            if (state.remaining.length === 0 || state.isDrawing) return;

            state.isDrawing = true;
            elements.drawBtn.disabled = true;
            elements.resultDisplay.style.color = "#666666";
            elements.resultDisplay.style.transform = `scale(${CONFIG.ANIMATION_SCALE_DOWN})`;

            let iterations = 0;
            const interval = setInterval(() => {
                const randomIndex = Math.floor(Math.random() * state.remaining.length);
                const tempStudent = getStudentById(state.remaining[randomIndex]);
                elements.resultDisplay.innerText = formatName(tempStudent.identite);

                if (++iterations > CONFIG.DRAW_ITERATIONS) {
                    clearInterval(interval);
                    completeDrawing();
                }
            }, CONFIG.DRAW_INTERVAL);
        }

        function completeDrawing() {
            const finalIndex = Math.floor(Math.random() * state.remaining.length);
            const winnerId = state.remaining.splice(finalIndex, 1)[0];
            const winner = getStudentById(winnerId);

            elements.resultDisplay.innerText = formatName(winner.identite);
            elements.resultDisplay.style.color = THEME_HEX;
            elements.resultDisplay.style.transform = `scale(${CONFIG.ANIMATION_SCALE_UP})`;
            
            setTimeout(() => {
                elements.resultDisplay.style.transform = "scale(1)";
                state.isDrawing = false;
            }, CONFIG.ANIMATION_DURATION);

            saveState();
            renderList();
        }

        // ========== R√âINITIALISATION ========== 
        function resetDrawing() {
            showAlert(
                "Remettre √† z√©ro ?",
                "Tous les √©l√®ves seront √† nouveau disponibles pour le tirage.",
                () => {
                    state.remaining = state.rawData.map(el => el.id);
                    localStorage.removeItem(STORAGE_KEYS.remaining);
                    elements.resultDisplay.innerText = "PR√äT";
                    elements.resultDisplay.style.color = THEME_HEX;
                    renderList();
                }
            );
        }

        // ========== GESTION DES MODAUX ========== 
        function openHelp() {
            const container = document.getElementById('modal-body-content');
            container.innerHTML = `
                <h3 class="font-black text-sm uppercase mb-4 text-center" style="color: ${THEME_HEX}">
                    üìñ Guide du Tirage au Sort
                </h3>
                <div class="text-[12px] leading-relaxed space-y-4 text-left" style="color: #333">
                    <section>
                        <p class="font-bold mb-1" style="color: ${THEME_HEX}">üë• Gestion des √©l√®ves</p>
                        <p>‚Ä¢ <b>Absences :</b> Avant de commencer, cliquez sur les noms des √©l√®ves absents. Ils appara√Ætront gris√©s et barr√©s, et seront <b>exclus</b> du tirage.</p>
                        <p>‚Ä¢ <b>R√©cup√©ration :</b> Si vous avez cliqu√© par erreur sur un √©l√®ve, cliquez √† nouveau dessus pour le rendre √† nouveau disponible.</p>
                    </section>

                    <section>
                        <p class="font-bold mb-1" style="color: ${THEME_HEX}">üé≤ Le Tirage</p>
                        <p>‚Ä¢ <b>Lancer :</b> Appuyez sur "Tirer un pr√©nom". Une animation fait d√©filer les noms restants avant de s'arr√™ter sur l'heureux √©lu.</p>
                        <p>‚Ä¢ <b>Suivi :</b> Une fois qu'un √©l√®ve a √©t√© tir√©, il est automatiquement barr√© de la liste pour ne pas ressortir deux fois.</p>
                    </section>

                    <section>
                        <p class="font-bold mb-1" style="color: ${THEME_HEX}">‚öôÔ∏è Contr√¥les</p>
                        <p>‚Ä¢ <b>Compteur :</b> Sous le bouton, suivez en temps r√©el le nombre d'√©l√®ves qu'il reste √† interroger.</p>
                        <p>‚Ä¢ <b>R√†Z :</b> Le bouton rouge permet de r√©initialiser toute la classe (remettre tout le monde dans l'urne) sans recharger la page.</p>
                    </section>
                </div>
            `;
            
            const confirmBtn = document.getElementById('alertConfirmBtn');
            confirmBtn.innerText = "J'ai compris";
            confirmBtn.style.backgroundColor = THEME_HEX;
            confirmBtn.onclick = closeModal;
            
            document.getElementById('btn-secondary').style.display = 'none';
            document.getElementById('alertModal').style.display = 'flex';
        }

        function showAlert(title, text, onConfirm) {
            elements.modalBodyContent.innerHTML = `
                <h3 class="alert-title">${title}</h3>
                <p class="alert-text">${text}</p>
            `;
            
            elements.alertConfirmBtn.innerText = "Confirmer";
            elements.alertConfirmBtn.style.backgroundColor = THEME_HEX;
            
            // Cloner le bouton pour supprimer les anciens listeners
            const newBtn = elements.alertConfirmBtn.cloneNode(true);
            elements.alertConfirmBtn.parentNode.replaceChild(newBtn, elements.alertConfirmBtn);
            elements.alertConfirmBtn = newBtn;
            
            elements.alertConfirmBtn.onclick = () => {
                closeModal();
                onConfirm();
            };
            
            elements.btnSecondary.style.display = 'block';
            elements.btnSecondary.innerText = "Annuler";
            elements.alertModal.style.display = 'flex';
        }

        function closeModal() {
            elements.alertModal.style.display = 'none';
        }

        // ========== APPLICATION DES COULEURS DE GENRE ========== 
        function applySexColors() {
            const prefs = JSON.parse(localStorage.getItem(STORAGE_KEYS.theme));
            if (!prefs) return;

            if (prefs.fille && COLOR_MAP[prefs.fille]) {
                document.documentElement.style.setProperty('--student-name-girl', COLOR_MAP[prefs.fille]);
            }
            if (prefs.garcon && COLOR_MAP[prefs.garcon]) {
                document.documentElement.style.setProperty('--student-name-boy', COLOR_MAP[prefs.garcon]);
            }
        }

        // ========== APPLICATION DU TH√àME ========== 
        function applyTheme() {
            const isLight = localStorage.getItem(STORAGE_KEYS.themeMode) === 'light';
            document.body.classList.toggle('light-mode', isLight);

            const buttonElements = [
                elements.btnRetour,
                elements.btnRetourListe,
                elements.btnAide,
                elements.drawBtn
            ];

            buttonElements.forEach(el => {
                if (el) {
                    el.style.backgroundColor = THEME_HEX;
                    el.style.color = THEME_TEXT_COLOR;
                    
                    const svg = el.querySelector('svg');
                    if (svg) svg.style.color = THEME_TEXT_COLOR;
                }
            });

            elements.resultDisplay.style.color = THEME_HEX;
        }

        // ========== GESTION DES √âV√âNEMENTS ========== 
        function initEventListeners() {
            // Bouton aide
            elements.btnAide.addEventListener('click', openHelp);
            
            // Bouton tirage
            elements.drawBtn.addEventListener('click', drawName);
            
            // Bouton r√©initialisation
            elements.resetBtn.addEventListener('click', resetDrawing);
            
            // Bouton annuler du modal
            elements.btnSecondary.addEventListener('click', closeModal);
            
            // Fermeture du modal en cliquant sur l'overlay
            elements.alertModal.addEventListener('click', (event) => {
                if (event.target === elements.alertModal) closeModal();
            });
            
            // Emp√™cher la fermeture en cliquant sur le contenu
            elements.alertModal.querySelector('.modal-content').addEventListener('click', (e) => {
                e.stopPropagation();
            });
            
            // Touche √âchap pour fermer le modal
            window.addEventListener('keydown', (event) => {
                if (event.key === "Escape") closeModal();
            });
        }

        // ========== INITIALISATION ========== 
        function init() {
            applySexColors();
            applyTheme();
            initEventListeners();
            renderList();
        }

        // D√©marrage de l'application
        window.onload = init;
    </script>

</body>
</html>